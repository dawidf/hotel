{% extends '::base.html.twig' %}
{% block javascripts %}
    {{ parent() }}
    <script>
        $( document ).ready(function() {
//            $('#task-form').submit(function () {
//                var url = '/app_dev.php/fileTest';
//                console.log($('#task-form').serialize());
//                $.ajax({
//                    url: url,
//                    method: "POST",
//                    data: $('#task-form').serialize(),
//                    success: function(data)
//                    {
//                        console.log(data);
//                    },
//                    error: function(error)
//                    {
//                        console.log(error);
//                    }
//                });
//                return false;
//
//            });


            $(':file').change(function(){
                var file = this.files[0];
                var name = file.name;
                var size = file.size;
                var type = file.type;

                //Your validation
            });

            $(':button').click(function(){
                var formData = new FormData($('form')[0]);

                var data = new FormData();
                $.each($('#hotel_admin_bundle_file_type_files')[0].files, function(i, file) {
                    data.append('files-'+i, file);

                });


                $.ajax({
                    url: '/app_dev.php/fileTest',
                    data: data,
                    cache: false,
                    contentType: false,
                    processData: false,
                    type: 'POST',
                    xhr: function() {
                        var xhr = new window.XMLHttpRequest();
                        $(".container").append('<div class="progress"><div id="progressBar" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"><span class="sr-only">40% Complete (success)</span></div></div>');


                        xhr.upload.addEventListener("progress", function(evt) {
                            if (evt.lengthComputable) {
                                percentComplete = evt.loaded / evt.total;
                                percentComplete = parseInt(percentComplete * 100);
                                $('#progressBar').css('width', percentComplete+"%");

                                console.log(percentComplete);


                            }
                        }, false);

                        return xhr;
                    },
                    success: function(data){
                        if (percentComplete === 100) {
                            setTimeout(function () {
                                $('.progress').fadeOut('fast', function () {
                                    $('.progress').remove();
                                });
                            }, 1000);
                        }
                    },
                    error: function (errors) {
                        console.log(errors);
                    }
                });




//                $.ajax({
//                    url: '/app_dev.php/fileTest',  //Server script to process data
//                    type: 'POST',
//                    xhr: function() {  // Custom XMLHttpRequest
//                        var myXhr = $.ajaxSettings.xhr();
//                        if(myXhr.upload){ // Check if upload property exists
//                            myXhr.upload.addEventListener('progress', function (asd) {
//                                alert(asd);
//                            }, false); // For handling the progress of the upload
//                        }
//                        return myXhr;
//                    },
//                    //Ajax events
////                    beforeSend: beforeSendHandler,
//                    success: function (success) {
//                        alert('dodano poprawnie');
//                    },
////                    error: errorHandler,
//                    // Form data
//                    data: data,
//                    //Options to tell jQuery not to process data or worry about content-type.
//                    cache: false,
//                    contentType: false,
//                    processData: false
//                });
            });
        });

    </script>
{% endblock %}
{% block body %}
    {{ form(form) }}
    <button id="asd">Upload this shit</button>
{% endblock %}